<!-- home.html -->
<div class="chat-container">
  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">Loading...</div>
  </div>

  <!-- Main chat interface -->
  <div *ngIf="!isLoading && currentUser" class="chat-content">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-content">
        <h1>GlobalChat</h1>
        <span class="subtitle">Connect with the world</span>
      </div>
      <div class="header-right">
        <div class="online-indicator">
          <div class="online-dot"></div>
          <span>{{ onlineUsers.length }} Online</span>
        </div>

        <button class="profile-button" (click)="toggleMenu()">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </button>
      </div>
    </div>

    <!-- Profile Menu -->
    <div class="profile-menu-overlay" *ngIf="isMenuOpen" (click)="toggleMenu()">
      <div class="profile-menu" (click)="$event.stopPropagation()">
        <div class="profile-header">
          <div class="profile-avatar">
            <svg
              width="40"
              height="40"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div class="profile-info">
            <div class="profile-name">{{ currentUserDisplayName }}</div>
            <div class="profile-email">{{ currentUser.email }}</div>
          </div>
        </div>

        <div class="menu-divider"></div>

        <div class="menu-items">
          <button class="menu-item" (click)="onSettingsClick()">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
            </svg>
            Settings
          </button>

          <button class="menu-item" (click)="onHelpClick()">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Help
          </button>

          <div class="menu-divider"></div>

          <button class="menu-item logout" (click)="onLogoutClick()">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16,17 21,12 16,7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Log Out
          </button>
        </div>
      </div>
    </div>

    <!-- Messages Area -->
    <div class="chat-messages">
      <div
        *ngFor="let message of messages"
        class="message-wrapper"
        [class.own-message]="message.isOwnMessage"
        [class.system-message]="message.userId === 'system'"
      >
        <div class="message-bubble">
          <div
            class="message-header"
            *ngIf="!message.isOwnMessage && message.userId !== 'system'"
          >
            <span class="username">{{ message.username }}</span>
            <span class="country">{{ message.country }}</span>
          </div>

          <div class="message-text">{{ message.text }}</div>

          <div class="message-time">{{ message.timestamp | date:'HH:mm' }}</div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="chat-input">
      <div class="input-container">
        <div class="user-indicator">
          <span class="your-flag">{{ currentUserCountry }}</span>
          <span class="your-name">{{ currentUserDisplayName }}</span>
        </div>

        <textarea
          [(ngModel)]="currentMessage"
          (keydown)="onKeyPress($event)"
          placeholder="Share your message with the world..."
          class="message-input"
          rows="1"
          [disabled]="!currentUser"
        >
        </textarea>

        <button
          (click)="sendMessage()"
          [disabled]="currentMessage.trim() === '' || !currentUser"
          class="send-button"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22,2 15,22 11,13 2,9"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Error state when user is not available -->
  <div *ngIf="!isLoading && !currentUser" class="error-container">
    <p>Please log in to access GlobalChat.</p>
    <button (click)="onGoToLogin()" class="login-button">Go to Login</button>
  </div>
</div>
